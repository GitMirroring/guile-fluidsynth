@c -*- mode: texinfo; coding: utf-8 -*-
@c This is part of the Guile-Fluidsynth Reference Manual.
@c Copyright (C) 2025 - David Pirotte (david at altosw dot be)
@c See the file guile-fluidsynth.texi for copying conditions.


@node Using Guile-Fluidsynth
@c @chapter Using Guile-Fluidsynth
@unnumbered II. Using Guile-Fluidsynth


@node Preliminary Note
@section Preliminary Note

The project name is guile-fluiddsynth, but for practicle reasons the
module name is @code{f-synth}.

As a guile-fluidsynth user, it is the only module you need to use
(import) to get access to the public api of the project, namely its
public goops classes, accessors, methods and procedures.


@node Customizing Guile-Fluidsynth
@section Customizing Guile-Fluidsynth

Guile-Fluidsynth defines a few default values, kept in a @code{stow} (a
storage functionality implemented using a hash table). To list the
content of the stow, call @code{(stow->alist)}:

@lisp
scheme@@(guile-user)> ,use (f-synth)
scheme@@(guile-user)> (stow->alist)
@result{} $5 = ((soundfont . "/usr/share/sounds/sf2/FluidR3_GM.sf2") (gain . 0.4))
@end lisp

As you can see, there are currently two stow entries, one for the
default @code{soundfont} and the other for the default @code{gain}.

@subsection The soundfont

The default soundfont value is
@file{/usr/share/sounds/sf2/FluidR3_GM.sf2}, which is the common
location and name on most GNU Linux (platform) distributions.

Guile-Fluidsynth users must ensure either this font exists, or customize
the soundfont stow entry depending on their distro and/or platform,
using the @code{stow-set!} api, here is an example:

@lisp
scheme@@(guile-user)> ,use (f-synth)
scheme@@(guile-user)> (stow-set! 'soundfont "/the/path/to/example.sf2")
@end lisp

Guile-Fluidsynth will raise an exception, attempting to make a
synthesizer, if it can't find the soundfont.

@subsection The gain

The default gain value is @code{0.4}@footnote{The upstream default value
 is 0.2, but that renders to emited sounds barely audible, even with a
 relatively high volume setting.}.

To customize the gain stow entry, use the @code{stow-set!} api, here is
an example:

@lisp
scheme@@(guile-user)> ,use (f-synth)
scheme@@(guile-user)> (stow-set! 'gain 0.5)
@end lisp


@node Make a Synthesizer - Play a Note
@section Make a Synthesizer - Play a Note

Let's start guile-fluidsynth, make a synthesizer and play a note. Open a
terminal and launch guile, or if you use @uref{@value{UEMACS}, Emacs}
which, coupled with @uref{@value{UGEISER}, Geiser} absolutely rocks
@code{:-)}, then fire emacs, followed by M-x geiser-guile, then:

@lisp
scheme@@(guile-user)> ,use (f-synth)
scheme@@(guile-user)> (make <synth>)
@result{} $5 = #<<synth> 7f746c768db0> @footnote{It may display the
 following warning: fluidsynth: warning: Failed to set thread to high
 priority.

The warning means that
FluidSynth tried to increase a thread priority, but failed. This is
usually due to insufficient privileges of the user running
FluidSynth. This page has quite a good description on how to configure
your system user limits to allow higher priority threads:
https://jackaudio.org/faq/linux_rt_config.html

Having said that: depending on your use-case it might not be
necessary. For example, if you use FluidSynth to render MIDI to a file,
then this warning can safely be ignored.

But if you want to use FluidSynth as a real-time synth, then changing
the rtprio and memlock levels as explained by the above link will
definitely help.}

scheme@@(guile-user)> (noteon $5 0 60 100)
@end lisp

If everything went well, it should have played a "Yamaha Grand Piano" C4
(middle c) 261.63 Hz note.

@cartouche Important
As the default instrument is a "Yamaha Grand Piano"@footnote{The
default preselected bank and program for the midi channel 0, using the
FluidR3_GM.sf2 soundfont.}, which is a percusive instrument, the note is
played and will slowly fade till no sound can be heard.

If you affect a none percusive instrument to a midi channel, such as an
organ for example, then you have to call @code{noteoff}:

@lisp
(noteoff $5 0 60)
@end lisp
@end cartouche
