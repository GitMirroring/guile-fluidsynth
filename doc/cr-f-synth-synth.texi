@c -*- mode: texinfo; coding: utf-8 -*-
@c This is part of the Guile-Fluidsynth Reference Manual.
@c Copyright (C) 2025 - David Pirotte (david at altosw dot be)
@c See the file guile-fluidsynth.texi for copying conditions.


@node Synth
@subsection Synth

The (f-synth synth) module defines the Guile-Fluidsynth high level api
to the SoundFont synthesizer.


@sp 1
@subheading Classes

@indentedblock
@table @code
@item @ref{<synth>}
@end table
@end indentedblock


@subheading Procedures, Accessors and Methods

@indentedblock
@table @code
@item @ref{!settings}
@item @ref{!synth}
@item @ref{!audiodriver}
@item @ref{!soundfont}
@item @ref{!sfid}
@item @ref{!gain}
@item @ref{noteon}
@item @ref{noteoff}
@item @ref{sfload}
@end table
@end indentedblock


@subheading Description

The Guile-Fluidsynth high level api to the SoundFont synthesizer.


@subheading Classes


@anchor{<synth>}
@deftp Class <synth>

The SoundFont synthesizer class.

It is an instance of @code{<class>}.

Superclasses are:

@indentedblock
@table @code
@item <object>
@end table
@end indentedblock

Directs slots are:

@indentedblock
@table @code
@item settings
@item synth
@item audio-driver
@item soundfont
@item sfid
@item gain
@end table
@end indentedblock

Class Precedence List:

@indentedblock
@table @code
@item <synth>
@item <object>
@item <top>
@end table
@end indentedblock

When making a @code{<synth>} instance, a new settings, audio driver and
synth objects are created, then a soundfont is loaded and the gain is
being set.

The initialize method will either use the f-synth default soundfont and
gain values, as defined and kept in the f-synth stow, or the values
passed to the make instance call, using the @code{#:soundfont} and as
@code{#:gain} optional keywords.

The default soundfont and gain values, as defined an kept in the f-synth
stow, are:

@lisp
(stow-ref 'soundfont)
@result{} "/usr/share/sounds/sf2/FluidR3_GM.sf2"

(stow-ref 'gain)
@result{} 0.4
@end lisp

@end deftp


@anchor{!settings}
@anchor{!synth}
@anchor{!audiodriver}
@anchor{!soundfont}
@anchor{!sfid}
@anchor{!gain}
@deffn Accessor !settings (inst <synth>)
@deffnx Accessor !synth (inst <synth>)
@deffnx Accessor !audiodriver (inst <synth>)
@deffnx Accessor !soundfont (inst <synth>)
@deffnx Accessor !sfid (inst <synth>)
@deffnx Accessor !gain (inst <synth>)

Returns the content of their respective slot for @var{inst}.
@end deffn


@anchor{noteon}
@deffn Method noteon (inst <synth>) chan key vel

Returns nothing.

Send a note-on event to a FluidSynth object. This function will take
care of proper legato playing. If a note on @var{chan} is already
playing at the given @var{key}, it will be released (even if it is
sustained). In other words, overlapping notes are not allowed.

The @var{chan} arg is a MIDI channel number in the range @code{[0 (-
n-chan 1)]}; @var{key} is a MIDI note number in the range @code{[0
127]}; @var{vel} is a MIDI velocity, a number in the range @code{[0
127]} (0 = noteoff).
@end deffn


@anchor{noteoff}
@deffn Method noteoff (inst <synth>) chan key

Returns nothing.

Send a note-off event to a FluidSynth object.

The @var{chan} arg is a MIDI channel number in the range @code{[0 (-
n-chan 1)]}; @var{key} is a MIDI note number in the range @code{[0
127]}.
@end deffn


@anchor{sfload}
@deffn Method sfload (inst <synth>) filename [(preset?s #t)]

Returns the sfid.

Load the SoundFont file specified by @var{filename}. When @var{presets}
is #t, all MIDI channels presets will be re-assigned.

@end deffn

